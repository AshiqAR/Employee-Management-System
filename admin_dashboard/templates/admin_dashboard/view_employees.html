{% extends "base.html" %}
{% load static %}

{% block title %}View Employees{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'css/view_employees.css' %}" />
{% endblock %}

{% block content %}
<div class="template-container">

  <h2>Employee List</h2>
  
  <!-- Search Bar -->
  <div class="search-container">
    <input type="text" id="searchInput" onkeyup="searchEmployees()" placeholder="Search for employees by name...">
  </div>

  <!-- Employee Table -->
  <table id="employeeTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">ID</th>
        <th onclick="sortTable(1)">Name</th>
        <th onclick="sortTable(2)">Designation</th>
        <th onclick="sortTable(3)">Department</th>
        <th onclick="sortTable(4)">Email</th>
      </tr>
    </thead>
    <tbody>
      {% for employee in employees %}
      <tr>
        <td>{{ employee.employee_id }}</td>
        <td class="emp-name">
          <a class="emp-name" href="{% url 'admin_dashboard:edit_employee' employee.employee_id %}">{{ employee.first_name }} {{ employee.last_name }}</a>
        </td>
        <td>{{ employee.designation.designation_name }}</td>
        <td>{{ employee.department.department_name }}</td>
        <td>{{ employee.email }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
  
  <!-- JavaScript for Search and Sort Functionality -->
  <script>
    function searchEmployees() {
      let input = document.getElementById('searchInput').value.toLowerCase();
      let table = document.getElementById('employeeTable');
      let rows = table.getElementsByTagName('tr');
      
      for (let i = 1; i < rows.length; i++) {
        let cells = rows[i].getElementsByTagName('td');
        let name = cells[1].textContent.toLowerCase();
        if (name.indexOf(input) > -1) {
          rows[i].style.display = '';
        } else {
          rows[i].style.display = 'none';
        }
      }
    }

    function sortTable(columnIndex) {
  let table = document.getElementById('employeeTable');
  let rows = Array.from(table.getElementsByTagName('tr')).slice(1);
  let ascending = table.getAttribute('data-sort-order') === 'asc';
  
  rows.sort((a, b) => {
    let cellA = a.getElementsByTagName('td')[columnIndex].textContent.trim();
    let cellB = b.getElementsByTagName('td')[columnIndex].textContent.trim();

    // Check if the column contains numeric values
    if (!isNaN(cellA) && !isNaN(cellB)) {
      cellA = parseFloat(cellA);
      cellB = parseFloat(cellB);
      return ascending ? cellA - cellB : cellB - cellA;
    }

    // Default to string comparison for non-numeric values
    if (cellA < cellB) return ascending ? -1 : 1;
    if (cellA > cellB) return ascending ? 1 : -1;
    return 0;
  });

  for (let row of rows) {
    table.getElementsByTagName('tbody')[0].appendChild(row);
  }

  table.setAttribute('data-sort-order', ascending ? 'desc' : 'asc');
}
  </script>
{% endblock %}
